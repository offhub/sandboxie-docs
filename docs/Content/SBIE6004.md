# SBIE6004

**Message** SBIE6004 The configuration %3 of box %2 requires a supporter certificate. Processes in this box will be terminated after 5 minutes. For prolonged use, please consider supporting this project.

**Severity**: Error (popup)

## Description

This error is shown when Sandboxie detects that a box configuration requires a supporter certificate (or an advanced supporter certificate) which is not present or not active. The message is displayed as a popup and may cause processes in the affected box to be terminated after a short grace period.

Typical scenarios include features that weaken isolation or enable privileged proxy operations (for example, EFS proxying) that are gated behind supporter certificate options.

## Typical Causes

- A feature that requires a supporter certificate is enabled in the box configuration (for example, `EnableEFS`), but the system does not have a valid active supporter certificate.
- The installed certificate is present but not marked active or lacking the required option flags (for example, the encryption flag used for EFS proxying).
- The certificate verification failed when queried from the driver/service.

## Suggested Actions

1. Review the box configuration mentioned in the message (`%3` is the configuration name and `%2` is the box name). Disable features that require a certificate if you do not intend to supply one.
2. If you intend to use the feature, install and activate a supporter certificate that includes the required option flags (see `EnableEFS.md` for EFS-related requirements).[^1]
3. Restart Sandboxie components (service/driver) after installing a certificate so the driver and service can detect the new certificate.
4. If you continue to see the message despite a valid certificate, collect logs (enable tracing) and check the service/driver certificate query path for errors.

## Related Messages

- [SBIE2225](SBIE2225.md) — EFS access attempt failed; often related when EFS proxying is attempted without a proper certificate.
- [SBIE6008](SBIE6008.md) / [SBIE6009](SBIE6009.md) — Other certificate-related configuration errors (message codes reserved for certificate requirements).

## Implementation Notes and Footnotes

These notes reference the implementation paths where SBIE6004 is emitted or handled. They are intended for maintainers and advanced users for tracing the decision logic; line numbers are intentionally omitted.

[ ^1 ]: The English message text above is defined in the messages resource and is surfaced to the user as a popup error when the condition is met.

[ ^2 ]: In the UserServer request handling (for example, when servicing EFS proxy open requests), the code queries the certificate information using `SbieApi_QueryDrvInfo(...)` and checks for `CertInfo.active` and the appropriate option flag (e.g., `CertInfo.opt_enc`). If the certificate is not active or lacks the option, the code emits a certificate error via `SbieApi_LogMsgExt(session_id, 6004, strings);` and denies the operation.

[ ^3 ]: The client-side UI/service code treats message codes 6004 (and related codes such as 6008/6009) as certificate errors and will display them to the user (see the SandMan UI handling for certificate-related messages).

[ ^4 ]: Features that commonly trigger this check include EFS proxying (`EnableEFS`) where the UserServer attempts to handle file opens on behalf of sandboxed processes; see `EnableEFS.md` for more details and cross-references.

---

_See also_: [EnableEFS.md](EnableEFS.md) — explains EFS proxying, certificate requirements, and related logging (SBIE2225). This document intentionally reuses those explanations where relevant to avoid duplication.

